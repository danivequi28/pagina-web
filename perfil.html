<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Perfil | La Verdad</title>
    <style>
        :root {
            --ink: #0f0f0f;
            --soft: #555555;
            --border: #e1e1e1;
            --background: #f8f7f4;
            --accent: #0d6efd;
            --text-scale: 1;
            --font-base: "Inter", "Roboto", Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: var(--font-base);
            background: var(--background);
            color: var(--ink);
            font-size: calc(16px * var(--text-scale));
        }

        input[type="text"],
        input[type="email"],
        input[type="search"],
        input[type="password"],
        input[type="tel"],
        input[type="url"],
        input[type="number"],
        textarea {
            font-family: var(--font-base);
            font-size: 16px;
            font-weight: 400;
            line-height: 1.5;
            color: var(--ink);
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: #fff;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="search"]:focus,
        input[type="password"]:focus,
        input[type="tel"]:focus,
        input[type="url"]:focus,
        input[type="number"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--ink);
            box-shadow: 0 0 0 2px rgba(15, 15, 15, 0.08);
        }

        input::placeholder,
        textarea::placeholder {
            font-family: inherit;
            font-size: 16px;
            font-weight: 400;
            line-height: 1.5;
            color: var(--soft, #555555);
            opacity: 1;
        }

        .profile-shell {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 20px 80px;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .wordmark {
            font-family: var(--font-base);
            font-size: 30px;
            letter-spacing: 0.12em;
            font-weight: 700;
            text-transform: uppercase;
            text-decoration: none;
            color: inherit;
        }

        .back-link {
            font-size: 14px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--soft);
            text-decoration: none;
        }

        .profile-layout {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 28px;
        }

        .profile-card {
            background: #fff;
            border-radius: 24px;
            padding: 28px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--ink);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 34px;
            margin: 0 auto;
        }

        .profile-name {
            text-align: center;
            font-size: 24px;
            margin: 0;
        }

        .profile-email {
            text-align: center;
            color: var(--soft);
            margin: 4px 0 12px;
            font-size: 14px;
            word-break: break-all;
        }

        .profile-role {
            text-align: center;
            margin: 0;
            font-size: 13px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #c08a11;
            display: none;
        }

        .profile-stats {
            display: flex;
            justify-content: space-between;
            text-align: center;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            padding: 16px 0;
        }

        .profile-stats span {
            display: block;
            font-size: 20px;
            font-weight: 600;
        }

        .ghost-button {
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 10px 16px;
            background: #fff;
            color: var(--ink);
            font-size: 14px;
            cursor: pointer;
            transition: border 0.2s ease;
            display: block;
            text-align: center;
            text-decoration: none;
        }

        .ghost-button:hover {
            border-color: var(--ink);
        }

        .logout-button {
            border: none;
            border-radius: 999px;
            padding: 12px;
            background: #d32f2f;
            color: #fff;
            font-size: 15px;
            cursor: pointer;
            margin-top: 8px;
        }

        .profile-panels {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }

        .panel {
            background: #fff;
            border-radius: 24px;
            padding: 28px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        }

        .panel h2 {
            margin-top: 0;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-size: 16px;
        }

        .panel-placeholder {
            border: 2px dashed var(--border);
            border-radius: 18px;
            padding: 30px;
            text-align: center;
            color: var(--soft);
            font-size: 15px;
        }

        .profile-posts {
            margin-top: 18px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .profile-posts article {
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 18px 20px;
            background: #fff;
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.05);
        }

        .profile-posts .post-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 12px;
        }

        .profile-posts .post-owner {
            font-weight: 600;
            font-size: 15px;
        }

        .profile-posts .post-date {
            font-size: 12px;
            color: var(--soft);
            letter-spacing: 0.04em;
        }

        .profile-posts .post-body {
            margin-top: 12px;
            background: #f8f7f4;
            border-radius: 14px;
            padding: 14px;
            font-size: 15px;
            line-height: 1.5;
        }

        .profile-posts .post-menu {
            position: relative;
        }

        .profile-posts .menu-trigger {
            border: none;
            background: transparent;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: var(--soft);
        }

        .profile-posts .menu-trigger:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .profile-posts .menu-trigger svg {
            width: 18px;
            height: 18px;
        }

        .profile-posts .menu-panel {
            position: absolute;
            top: 36px;
            right: 0;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 14px;
            box-shadow: 0 18px 36px rgba(0, 0, 0, 0.12);
            min-width: 170px;
            padding: 6px;
            display: none;
            z-index: 5;
        }

        .profile-posts .menu-panel.is-open {
            display: block;
        }

        .profile-posts .menu-panel button {
            width: 100%;
            border: none;
            background: transparent;
            display: flex;
            flex-direction: row-reverse;
            align-items: center;
            justify-content: flex-end;
            gap: 10px;
            padding: 9px 10px;
            font-size: 14px;
            cursor: pointer;
            color: var(--ink);
        }

        .profile-posts .menu-panel button:hover {
            background: rgba(0, 0, 0, 0.04);
        }

        .profile-posts .menu-panel svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 1.8;
            fill: none;
        }

        .profile-posts .menu-panel .danger {
            color: #c23616;
        }

        @media (max-width: 900px) {
            .profile-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="accessibility.css">
</head>
<body>
    <div class="profile-shell">
        <header class="profile-header">
            <a class="wordmark" href="archivp.html">La Verdad</a>
            <a class="back-link" href="archivp.html">&#8592; Volver a portada</a>
        </header>

        <main class="profile-layout">
            <aside class="profile-card">
                <div class="avatar" data-avatar>LV</div>
                <h1 class="profile-name" data-profile-name>Lector</h1>
                <p class="profile-role" data-profile-role hidden>Periodista</p>
                <p class="profile-email" data-profile-email>usuario@laverdad.es</p>
                <p style="text-align:center;color:var(--soft);margin:0;">Miembro desde 2024</p>
                <div class="profile-stats">
                    <div>
                        <span data-followers>12,4K</span>
                        <small>Seguidores</small>
                    </div>
                    <div>
                        <span data-following>284</span>
                        <small>Seguidos</small>
                    </div>
                </div>
                <a class="ghost-button" href="ajustes.html">Ajustes</a>
                <a class="ghost-button" href="biblioteca.html">Biblioteca</a>
                <button class="logout-button" type="button" data-logout>Cerrar sesión</button>
            </aside>

            <section class="profile-panels">
                <article class="panel" data-profile-news-panel hidden>
                    <h2>Noticias publicadas</h2>
                    <div class="panel-placeholder" data-profile-news-placeholder>
                        En esta zona podr&aacute;s consultar las noticias que publiques desde la redacci&oacute;n.
                    </div>
                </article>
                <article class="panel" data-profile-post-panel>
                    <h2>Post subidos</h2>
                    <div class="panel-placeholder" data-profile-placeholder>
                        En esta zona podr&aacute;s consultar tus aportaciones a la comunidad.
                    </div>
                    <div class="profile-posts" data-profile-posts></div>
                </article>
            </section>
        </main>
    </div>


    <div class="accessibility-dock" data-access-dock>
        <button class="dock-handle" type="button" aria-label="Ocultar opciones de accesibilidad" data-dock-toggle>&gt;</button>
        <button class="accessibility-fab" type="button" aria-label="Opciones de accesibilidad" aria-expanded="false">
            <span class="sr-only">Accesibilidad</span>
            <span class="wheelchair-icon">&#9855;</span>
        </button>
    </div>
    <div class="accessibility-panel" aria-hidden="true" data-access-panel>
        <header>
            <h2>Accesibilidad</h2>
            <button class="panel-close" type="button" aria-label="Cerrar panel">&times;</button>
        </header>
        <div class="panel-section">
            <div class="control-row">
                <div class="control-text">
                    <strong>Lectura en Voz Alta</strong>
                    <small>Modo para ciegos</small>
                </div>
                <button class="access-switch" type="button" role="switch" aria-checked="false" data-toggle-class="voice-mode">
                    <span class="switch-thumb"></span>
                </button>
            </div>
            <div class="control-row">
                <div class="control-text">
                    <strong>Alto contraste</strong>
                    <small>Fondo oscuro y texto claro</small>
                </div>
                <button class="access-switch" type="button" role="switch" aria-checked="false" data-toggle-class="high-contrast">
                    <span class="switch-thumb"></span>
                </button>
            </div>
        </div>
        <div class="panel-section">
            <div class="control-row">
                <div class="control-text">
                    <strong>Aumentar tamaño del texto</strong>
                    <small>Define el zoom de lectura</small>
                </div>
                <div class="text-scale-controls">
                    <button type="button" class="text-scale-button" data-scale-step="-0.1" aria-label="Reducir texto">-</button>
                    <span data-text-scale>100%</span>
                    <button type="button" class="text-scale-button" data-scale-step="0.1" aria-label="Aumentar texto">+</button>
                </div>
            </div>
            <div class="control-row">
                <div class="control-text">
                    <strong>Fuente Accesible / Disléxica</strong>
                    <small>Elige la tipografía</small>
                </div>
                <div class="font-picker" role="radiogroup" aria-label="Opciones de fuente accesible">
                    <button type="button" class="font-choice" role="radio" aria-checked="true" data-font-class="font-accessible">Accesible</button>
                    <button type="button" class="font-choice" role="radio" aria-checked="false" data-font-class="font-dyslexic">Disléxica</button>
                </div>
            </div>
        </div>
        <div class="panel-section">
            <div class="control-row">
                <div class="control-text">
                    <strong>Subrayar y resaltar enlaces</strong>
                    <small>Ayuda a detectar destinos clicables</small>
                </div>
                <button class="access-switch" type="button" role="switch" aria-checked="false" data-toggle-class="links-highlight">
                    <span class="switch-thumb"></span>
                </button>
            </div>
            <div class="control-row">
                <div class="control-text">
                    <strong>Desactivar animaciones</strong>
                    <small>Elimina transiciones activas</small>
                </div>
                <button class="access-switch" type="button" role="switch" aria-checked="false" data-toggle-class="animations-off">
                    <span class="switch-thumb"></span>
                </button>
            </div>
        </div>
    </div>

                <script>
        (function () {
            const profileNameEl = document.querySelector("[data-profile-name]");
            const profileEmailEl = document.querySelector("[data-profile-email]");
            const roleBadgeEl = document.querySelector("[data-profile-role]");
            const newsPanel = document.querySelector("[data-profile-news-panel]");
            const newsPlaceholder = document.querySelector("[data-profile-news-placeholder]");
            const avatarEl = document.querySelector("[data-avatar]");
            const followersEl = document.querySelector("[data-followers]");
            const followingEl = document.querySelector("[data-following]");
            const logoutBtn = document.querySelector("[data-logout]");
            const postsWrapper = document.querySelector("[data-profile-posts]");
            const postsPlaceholder = document.querySelector("[data-profile-placeholder]");
            const postsStorageKey = "laVerdadForumPosts";
            const ROLE_KEY = "laVerdadRole";

            const initialsFrom = (name) => {
                const parts = name.split(/[\s._-]+/).filter(Boolean);
                if (!parts.length) return name.charAt(0).toUpperCase();
                return parts.slice(0, 2).map((part) => part.charAt(0)).join("").toUpperCase();
            };

            const escapeHtml = (value) =>
                value
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#39;");

            const formatPostBody = (text) => escapeHtml(text).replace(/\n/g, "<br>");

            const formatDate = (iso) => {
                try {
                    return new Date(iso).toLocaleString("es-ES", {
                        day: "numeric",
                        month: "short",
                        hour: "2-digit",
                        minute: "2-digit"
                    });
                } catch {
                    return "";
                }
            };

            const params = new URLSearchParams(window.location.search);
            const userParam = params.get("user");
            if (userParam) {
                localStorage.setItem("laVerdadUser", userParam.trim());
                if (history.replaceState) {
                    history.replaceState({}, document.title, window.location.pathname);
                }
            }

            const storedUser = localStorage.getItem("laVerdadUser");
            if (!storedUser) {
                window.location.href = "login.html";
                return;
            }

            const isJournalist = localStorage.getItem(ROLE_KEY) === "journalist";

            profileNameEl.textContent = storedUser;
            avatarEl.textContent = initialsFrom(storedUser);
            const storedEmail = localStorage.getItem("laVerdadEmail");
            if (profileEmailEl) {
                profileEmailEl.textContent = storedEmail || "Sin correo asociado";
                profileEmailEl.style.opacity = storedEmail ? "1" : "0.7";
            }
            if (roleBadgeEl) {
                roleBadgeEl.hidden = !isJournalist;
                roleBadgeEl.style.display = isJournalist ? "block" : "none";
                if (isJournalist) {
                    roleBadgeEl.textContent = "Periodista";
                }
            }
            if (newsPanel) {
                newsPanel.hidden = !isJournalist;
                if (newsPlaceholder) {
                    newsPlaceholder.style.display = isJournalist ? "block" : "none";
                }
            }
            followersEl.textContent = "12,4K";
            followingEl.textContent = "356";

            const readPosts = () => {
                try {
                    return JSON.parse(localStorage.getItem(postsStorageKey)) || [];
                } catch {
                    return [];
                }
            };

            const writePosts = (posts) =>
                localStorage.setItem(postsStorageKey, JSON.stringify(posts));

            const renderPosts = () => {
                if (!postsWrapper || !postsPlaceholder) return;
                const posts = readPosts().filter((post) => post.user === storedUser);
                if (!posts.length) {
                    postsPlaceholder.style.display = "block";
                    postsWrapper.innerHTML = "";
                    return;
                }
                postsPlaceholder.style.display = "none";
                const fragment = document.createDocumentFragment();
                posts.forEach((post) => {
                    const card = document.createElement("article");
                    card.setAttribute("data-profile-post", "");
                    if (typeof post.id === "number") {
                        card.dataset.postId = String(post.id);
                    }
                    card.innerHTML = `
                        <div class="post-header">
                            <div>
                                <div class="post-owner">${escapeHtml(post.user)}</div>
                                <div class="post-date">${formatDate(post.createdAt)}</div>
                            </div>
                            <div class="post-menu" data-profile-menu>
                                <button class="menu-trigger" type="button" aria-label="Abrir opciones" data-profile-menu-trigger>
                                    <svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round">
                                        <circle cx="5" cy="12" r="1.5"></circle>
                                        <circle cx="12" cy="12" r="1.5"></circle>
                                        <circle cx="19" cy="12" r="1.5"></circle>
                                    </svg>
                                </button>
                                <div class="menu-panel" data-profile-menu-panel>
                                    <button type="button" data-profile-action="edit">
                                        <svg viewBox="0 0 24 24"><path d="M3 21v-3l12-12 3 3-12 12z"></path><line x1="14" y1="4" x2="20" y2="10"></line></svg>
                                        Editar
                                    </button>
                                    <button type="button" class="danger" data-profile-action="delete">
                                        <svg viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                        Borrar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="post-body">${formatPostBody(post.text)}</div>
                    `;
                    fragment.appendChild(card);
                });
                postsWrapper.innerHTML = "";
                postsWrapper.appendChild(fragment);
            };

            renderPosts();

            const closeProfileMenus = () => {
                document
                    .querySelectorAll("[data-profile-menu-panel]")
                    .forEach((panel) => panel.classList.remove("is-open"));
            };

            const handlePostAction = (action, postId) => {
                const posts = readPosts();
                const post = posts.find(
                    (entry) => entry.id === postId && entry.user === storedUser
                );
                if (!post) return;
                if (action === "delete") {
                    if (!confirm("\u00BFSeguro que quieres borrar esta publicaci\u00F3n?")) return;
                    const updated = posts.filter((entry) => entry.id !== postId);
                    writePosts(updated);
                    renderPosts();
                } else if (action === "edit") {
                    const edited = prompt("Edita tu publicaci\u00F3n:", post.text);
                    if (edited === null) return;
                    if (!confirm("\u00BFGuardar los cambios?")) return;
                    post.text = edited.trim();
                    writePosts(posts);
                    renderPosts();
                }
            };

            document.addEventListener("click", (event) => {
                const trigger = event.target.closest("[data-profile-menu-trigger]");
                if (trigger) {
                    const panel = trigger.parentElement?.querySelector("[data-profile-menu-panel]");
                    if (!panel) return;
                    const isOpen = panel.classList.contains("is-open");
                    closeProfileMenus();
                    if (!isOpen) {
                        panel.classList.add("is-open");
                    }
                    return;
                }

                const actionBtn = event.target.closest("[data-profile-action]");
                if (actionBtn) {
                    const article = actionBtn.closest("[data-profile-post]");
                    if (!article) return;
                    const postId = Number(article.dataset.postId);
                    if (Number.isNaN(postId)) return;
                    const action = actionBtn.dataset.profileAction;
                    if (!action) return;
                    closeProfileMenus();
                    handlePostAction(action, postId);
                    return;
                }

                if (!event.target.closest("[data-profile-menu-panel]")) {
                    closeProfileMenus();
                }
            });

            logoutBtn.addEventListener("click", () => {
                if (confirm("\u00BFSeguro que quieres cerrar sesi\u00F3n?")) {
                    localStorage.removeItem("laVerdadUser");
                    localStorage.removeItem("laVerdadEmail");
                    localStorage.removeItem(ROLE_KEY);
                    document.dispatchEvent(new CustomEvent("laverdad:role-change"));
                    window.location.href = "archivp.html?logout=1";
                }
            });
        })();
    </script>





    <script src="accessibility.js"></script>
</body>
</html>

